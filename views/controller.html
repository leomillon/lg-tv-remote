{% extends 'layout.html' %}

{% block content %}
    <div class="container-fluid">
        <!-- Navbar -->
        <div class="navbar navbar-default" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">Controller</a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="#" id="end-pairing">Exit</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="row">
            <div class="col-xs-4">
                <div class="margin-bt">
                    <a class="btn btn-default btn-block controller-key" href="#" title="External sources" data-key-value="{{ KEYS.EXTERNAL_INPUT }}"><i class="fa fa-external-link"></i></a>
                </div>
            </div>
            <div class="col-xs-4">
                <div class="margin-bt">
                    <a class="btn btn-default btn-block controller-key" href="#" title="Direction up" data-key-value="{{ KEYS.DIRECTION.UP }}"><i class="fa fa-caret-up"></i></a>
                </div>
            </div>
            <div class="col-xs-4">
                <div class="margin-bt">
                    <a class="btn btn-default btn-block controller-key" href="#" title="Current program info" data-key-value="{{ KEYS.CURRENT_PROG_INFO }}"><i class="fa fa-info"></i></a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-4">
                <div class="margin-bt">
                    <a class="btn btn-default btn-block controller-key" href="#" title="Direction left" data-key-value="{{ KEYS.DIRECTION.LEFT }}"><i class="fa fa-caret-left"></i></a>
                </div>
            </div>
            <div class="col-xs-4">
                <div class="margin-bt">
                    <a class="btn btn-default btn-block controller-key" href="#" title="Ok" data-key-value="{{ KEYS.OK }}">OK</a>
                </div>
            </div>
            <div class="col-xs-4">
                <div class="margin-bt">
                    <a class="btn btn-default btn-block controller-key" href="#" title="Direction right" data-key-value="{{ KEYS.DIRECTION.RIGHT }}"><i class="fa fa-caret-right"></i></a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-4">
                <a class="btn btn-default btn-block controller-key" href="#" title="Back" data-key-value="{{ KEYS.PREVIOUS }}"><i class="fa fa-reply"></i></a>
            </div>
            <div class="col-xs-4">
                <a class="btn btn-default btn-block controller-key" href="#" title="Direction down" data-key-value="{{ KEYS.DIRECTION.DOWN }}"><i class="fa fa-caret-down"></i></a>
            </div>
            <div class="col-xs-4">
                <a class="btn btn-default btn-block controller-key" href="#" title="Menu" data-key-value="{{ KEYS.HOME_MENU }}">Menu</a>
            </div>
        </div>

        <hr>

        <!-- Sound and channel commands -->
        <div class="row">
            <div class="col-xs-4">
                <div class="btn-group-vertical btn-block">
                    <a class="btn btn-default controller-key" href="#" title="Volume up" data-key-value="{{ KEYS.VOLUME.UP }}"><i class="fa fa-volume-up"></i></a>
                    <a class="btn btn-default controller-key" href="#" title="Volume down" data-key-value="{{ KEYS.VOLUME.DOWN }}"><i class="fa fa-volume-down"></i></a>
                    <a class="btn btn-default controller-key" href="#" title="Mute" data-key-value="{{ KEYS.VOLUME.MUTE }}"><i class="fa fa-volume-off"></i></a>
                </div>
            </div>
            <div class="col-xs-4 col-xs-offset-4">
                <div class="btn-group-vertical btn-block">
                    <a class="btn btn-default controller-key" href="#" title="Channel up" data-key-value="{{ KEYS.CHANNEL.UP }}">P+</a>
                    <a class="btn btn-default controller-key" href="#" title="Channel down" data-key-value="{{ KEYS.CHANNEL.DOWN }}">P-</a>
                    <a class="btn btn-default controller-key" href="#" title="Channel list" data-key-value="{{ KEYS.PROG_LIST }}"><i class="fa fa-list"></i></a>
                </div>
            </div>
        </div>

        <hr>

        <!-- Numbers -->
        <div class="row">
            <div class="col-xs-12">
                <div class="margin-bt">
                    <div class="btn-group btn-group-justified">
                        <a class="btn btn-default controller-key" href="#" data-key-value="{{ KEYS.NUMBER.ONE }}">1</a>
                        <a class="btn btn-default controller-key" href="#" data-key-value="{{ KEYS.NUMBER.TWO }}">2</a>
                        <a class="btn btn-default controller-key" href="#" data-key-value="{{ KEYS.NUMBER.TREE }}">3</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="margin-bt">
                    <div class="btn-group btn-group-justified">
                        <a class="btn btn-default controller-key" href="#" data-key-value="{{ KEYS.NUMBER.FOUR }}">4</a>
                        <a class="btn btn-default controller-key" href="#" data-key-value="{{ KEYS.NUMBER.FIVE }}">5</a>
                        <a class="btn btn-default controller-key" href="#" data-key-value="{{ KEYS.NUMBER.SIX }}">6</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="margin-bt">
                    <div class="btn-group btn-group-justified">
                        <a class="btn btn-default controller-key" href="#" data-key-value="{{ KEYS.NUMBER.SEVEN }}">7</a>
                        <a class="btn btn-default controller-key" href="#" data-key-value="{{ KEYS.NUMBER.HEIGHT }}">8</a>
                        <a class="btn btn-default controller-key" href="#" data-key-value="{{ KEYS.NUMBER.NINE }}">9</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-4 col-xs-offset-4">
                <button type="button" class="btn btn-default btn-block controller-key" data-key-value="{{ KEYS.NUMBER.ZERO }}">0</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {% parent %}
    <script>
        function getDevicePath() {
            return '/tv-api/device';
        }

        function sendCmd(cmd, callback) {
            $.post(getDevicePath() + '/cmd', { cmdValue: cmd })
            .done(callback);
        }

        function endPairing(callback) {
            $.post(getDevicePath() + '/disconnect')
            .done(callback);
        }

        $(function () {
            $('.controller-key').click(function () {
                var cmd = $(this).attr('data-key-value');
                sendCmd(cmd, function(success) {
                    if (!success) {
                        console.error('An error occured for cmd:', cmd);
                    }
                });
                event.preventDefault();
            });

            $('#end-pairing').click(function () {
                endPairing(function(success) {
                    if (success) {
                        window.location.href = "/";
                    } else {
                        console.error('An error occured when trying to end pairing');
                    }
                });
                event.preventDefault();
            });
        });
    </script>
{% endblock %}